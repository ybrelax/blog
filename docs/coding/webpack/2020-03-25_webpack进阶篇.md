---
category: 前端
tags:
  - webpack
date: 2020-03-25
title: webpack进阶篇
---

上章介绍了 webpack 基础篇，这章然我们继续深入;

<!--more-->

## 静态资源拷贝

如果我们在 index.html 中引入了本地的 js 文件，那么如何在打包的时候才能把它正确的引入进去呢？

```sh
|--public
|   |--index.html
|   |--js
|   |   |--index.js
|   |   |--other.js
```

那么这种情况，可以通过拷贝的形式放进打包目录，但是这是最不靠谱的方式，所以我们需要用到

```sh
npm install copy-webpack-plugin -D
```

webpack.config.js:

```js
new CopyWebpackPlugin(
  [
    {
      from: "public/js/*.js",
      to: path.resolve(__dirname, "dist", "js"),
      flatten: true
    }
  ],
  {
    ignore: ["other.js"]
  }
);
```

- flatten 设置为 true 是只拷贝文件，否则的话就连文件夹一起拷贝
- ignore 过滤掉不拷贝的文件

## ProvidePlugin 全局引入

作为 webpack 的内部插件，这个插件能帮助我们全局引入变量。

```js
new webpack.ProvidePlugin({
  identifier1: "module1",
  identifier2: ["module2", "property2"]
});
```

在 vue 或者 react 中我们不需要在每个组件中频繁的引入，所以可以这样

```js
new webpack.ProvidePlugin({
  React: "react",
  Component: ["react", "Component"], // 这种的默认导出为 module.exports
  Vue: ["vue/dist/vue.esm.js", "default"], // 这个地方加default，是因为默认导出的形式 export default
  $: "jquery",
  _map: ["lodash", "map"]
});
```

这样我们就可以在项目中使用 react, vue 这些变量了。

## 抽离 css

前面基础篇中打包实际上把 css 文件和在了 js 文件。实际开发中，css 文件也是非常大的。所以最好把他抽离出来。

所以这里我们需要用到

```sh
npm install mini-css-extract-plugin -D
```

接下来修改我们的配置文件

```js
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
module.exports = {
    // loader 配置
    module: {
        rules: [
            {
                test: /\.css$/,
                use: [{
                    loader: MiniCssExtractPlugin.loader,
                    options: {
                        hmr: isDev,
                        reloadAll: true,
                    }
                }
                    , 'css-loader', {
                    loader: 'postcss-loader',
                    options: {
                        plugins: function () {
                            return [
                                require('autoprefixer')()
                            ]
                        }
                    }
                }]
            }
        ]
    },
    // 插件配置
    plugins: [new MiniCssExtractPlugin({
        filename: 'css/[name].css',
        publicPath: '../' // 这里可以指定我们css存放的位置
    })],
}
```

这里我们将浏览器的配置放到了.browserslistrc 文件中；

```
last 1 version
> 0.25%
```

通过打包我们就可以看到 css 的变化，如果没有变化，可以相应的将值调小一点，满足低版本的需求，> 0.1%

### 针对 css 进行压缩

在线上发布的时候，我们的资源是需要进行压缩的，有必要减少网络资源的消耗。我们来安装下面这个插件来完成这步操作。

```sh
npm install optimize-css-assets-webpack-plugin -D
```

修改我们的配置

```js
const OptimizeCssPlugin = require('optimize-css-assets-webpack-plugin');
module.exports =  {
  plugins: {
    new OptimizeCssPlugin()
  }
}
```
这样配置 js 和 css 文件都能够被压缩
再次打包的时候，你可以看到文件被压缩了。当我们在开发环境的时候，可以不用对此进行压缩。

## 按需加载
